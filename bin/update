#!/usr/bin/env bash

command_name=$(basename $0)
dummy="echo"
args=()

usage() {
  cat <<EOF

Update and Upgrade system packages.

Usage:
  $command_name [option]
Options
  -h|--help : Show this usage

EOF
}

add_args() { args+=("$@"); }

check() {
  :
}

initialize() {
  while true; do
    [[ -z $1 ]] && break
    case "$1" in
    -h | --help) usage && exit 0 ;;
    -e) dummy= ;;
    #-f*|--file*) file=${1#*=} ;;
    #-f|--file) shift && file=$1 ;;
    *) add_args "$1" ;;
    esac
    shift
  done
  check
}

not_supported() { echo "Not supported." 1>&2 && exit 1; }
update_arch() {
  sudo pacman -Syuu --noconfirm "${args[@]}"
}
update_ubuntu() {
  sudo apt-get -y update "${args[@]}"
  sudo apt-get upgrade -y
  sudo apt-get dist-upgrade -y
}
update_msys() {
  scoop update
  local list="${args[@]}"
  if [[ -z $list ]]; then
    list=$(scoop list | grep -E '^ .*' | grep -v vagrant | awk '{print $1}' | tr '\n' ' ')
  fi
  scoop update "$list"
}
main() {
  initialize "$@"
  set -e
  local _os=$(os)
  case "$_os" in
  arch) update_arch ;;
  ubuntu) update_ubuntu ;;
  msys) update_msys ;;
  *) not_supported ;;
  esac
  ink yellow "Done!"
}
main "$@"
