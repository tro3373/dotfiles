#!/usr/bin/env bash

has() { command -v ${1} >&/dev/null; }
main() {
  local f=$1
  local key=$2
  local send_to=$3
  local opt=
  [[ -z $f || ! -e $f ]] && echo "Specify exist file." 1>&2 && exit 1
  [[ -z $key ]] && echo "Specify keyword" 1>&2 && exit 1
  [[ -n $send_to ]] && opt="-c $send_to"
  echo "Start waiting $key in $f.."
  tail -F -n 0 $f | grep -qe "$key"
  echo "Detect $key in $f!" |
    if has slk; then
      cat - | slk "$opt"
    else
      cat -
    fi
}
main "$@"
