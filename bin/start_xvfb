#!/usr/bin/env bash

has() { command -v ${1} >& /dev/null; }
main() {
  if ! has Xvfb || ! has VBoxClient; then
    return
  fi
  export DISPLAY=:0
  if [[ ! -f /tmp/.X0-lock ]]; then
    echo "==> Starting Xvfb .."
    Xvfb -screen 0 320x240x8 > /dev/null 2>&1 &
    sleep 0.5
  fi
  if ! pgrep -alf VBoxClient >& /dev/null; then
    echo "==> Starting VBoxClient .."
    VBoxClient --clipboard
  fi
}
main
