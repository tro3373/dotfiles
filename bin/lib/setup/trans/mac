#!/usr/bin/env bash

pre_setup() {
  # log "=> pre setting up"
  setup_brew
  _setup_apps
}

_setup_apps() {
  # MEMO: with-readline: Enable interactive(enable handle cursor) option when install.
  # brew install gpg --with-readline

  # Install gnu commands
  # MEMO:
  #   with-default-names: (No prefix `g` command install option) is no more exists!
  #   handl by path priority
  def_install bash git lua vim wget gpg jq
  def_install grep gawk gzip gnu-sed gnu-tar gnu-indent gnu-which gnu-time gnu-getopt
  def_install binutils coreutils diffutils findutils moreutils

  # Rosetta: To use app for intel in Apple silicone tip
  # ex) Google Japanese Ime
  exe sudo softwareupdate --install-rosetta
  # MEMO: brew version is not work. Install from Browser
  # def_install --cask google-japanese-ime
  # MEMO: No install via brew for auto update
  # def_install --cask google-chrome

}

load_update_arg_apps() {
  # XtraFinder
  # shellcheck disable=SC2034
  read -r -a args < <(
    echo "$(default_apps) iterm2 vscode scroll-reverser karabiner-elements alt-tab"
  )
}

post_setup() {
  _remove_localized
  _setup_mac_settings
  _setup_gui_apps
}

_remove_localized() {
  # Delete Localized directory names, and to set eng name Setting.
  del_if_exist ~/Applications/.localized
  del_if_exist ~/Desktop/.localized
  del_if_exist ~/Documents/.localized
  del_if_exist ~/Downloads/.localized
  del_if_exist ~/Movies/.localized
  del_if_exist ~/Music/.localized
  del_if_exist ~/Pictures/.localized
  del_if_exist ~/Public/.localized
  del_if_exist ~/Library/.localized
}

_setup_mac_settings() {
  # https://qiita.com/soushiy/items/b56d4961d54972bc4b9e

  # Schroll Bound animation off
  # exe defaults write -g NSScrollViewRubberbanding -bool no

  # ツールチップの表示
  # exe defaults write -g NSInitialToolTipDelay -integer 100
  # ダイアログの表示速度
  # exe defaults write -g NSWindowResizeTime 0.001

  # showing and hiding sheets, resizing preference windows, zooming windows
  # float 0 doesn't work
  # exe defaults write -g NSWindowResizeTime -float 0.001
  # rubberband scrolling (doesn't affect web views)
  # exe defaults write -g NSScrollViewRubberbanding -bool false
  # resizing windows before and after showing the version browser
  # also disabled by NSWindowResizeTime -float 0.001
  # exe defaults write -g NSDocumentRevisionsWindowTransformAnimation -bool false

  # メモリの解放
  # sudo purge
  # 通知センターをオフ
  # launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist

  # Do not create .DStore in Network drive
  exe defaults write com.apple.desktopservices DSDontWriteNetworkStores true

  # Delete background black in screen shot
  # exe defaults write com.apple.screencapture disable-shadow -boolean true
  # exe killall SystemUIServer

  ########################################################################
  # Dashborad
  ########################################################################
  # ダッシュボードを無効(DashboardからWidgetを削除)にしてメモリ節約と高速化。
  # exe defaults write com.apple.dashboard mcx-disabled -boolean true

  ########################################################################
  # Dock
  ########################################################################
  # Dockアニメーション
  # exe defaults write com.apple.dock autohide-time-modifier -float 0
  # exe defaults write com.apple.dock autohide-time-modifier -float 0.12
  # アプリがデスクトップ間を移動する際の速度を変更
  # exe defaults write com.apple.dock workspaces-edge-delay -float 0.2
  # Dockが表示されるまでの時間を高速化
  exe defaults write com.apple.dock autohide-delay -float 0.0
  exe defaults write com.apple.dock autohide-time-modifier -float 0.0
  # Dockにスペース(空白)を挿入
  # exe defaults write com.apple.dock persistent-others -array-add '{tile-data={}; tile-type="spacer-tile";}'
  # Dockの隠しアニメーション「Suck」を有効にする
  # exe defaults write com.apple.dock mineffect suck
  # launchpad animation off
  # exe defaults write com.apple.dock springboard-show-duration -float 0
  # exe defaults write com.apple.dock springboard-hide-duration -float 0
  # exe defaults write com.apple.dock springboard-page-duration -float 0
  # ミッションコントロールのアニメーション時間を変更
  # exe defaults write com.apple.dock expose-animation-duration -float 0.1
  # showing and hiding Mission Control, command+numbers
  # exe defaults write com.apple.dock expose-animation-duration -float 0
  exe killall Dock

  ########################################################################
  # Finder
  ########################################################################
  # animation all off for finder
  exe defaults write com.apple.finder DisableAllAnimations -boolean true
  # アイコンをドラッグした時のアニメーション
  exe defaults write com.apple.finder AnimateSnapToGrid -boolean false
  # ファインダーのアニメーションを削除
  exe defaults write com.apple.finder AnimateInfoPanes -boolean false
  # ?
  exe defaults write com.apple.finder FXEnableSlowAnimation -bool false
  # クイックルックで表示したテキストをコピペ
  exe defaults write com.apple.finder QLEnableTextSelection -bool true
  # 隠しファイルを表示
  exe defaults write com.apple.finder AppleShowAllFiles TRUE
  # Finderのパス表示をホームフォルダを基準にする
  exe defaults write com.apple.finder PathBarRootAtHome -bool yes
  # Finderのウィンドウタイトルにフルパスを表示
  exe defaults write com.apple.finder _FXShowPosixPathInTitle -bool true
  # Finderの音を消す
  exe defaults write com.apple.finder FinderSounds -bool no
  exe killall Finder

  ########################################################################
  # Safari
  ########################################################################
  # Safariの表示速度、Webサイトのアイコンを非表示にする。
  # exe defaults write com.apple.Safari WebKitInitialTimedLayoutDelay 0.25
  # exe defaults write com.apple.Safari WebIconDatabaseEnabled -boolean false
  # exe killall Safari
}

_setup_gui_apps() {
  cat <<'EOF'
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  Do below
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+ 1. (SystemSettings) Change Speed of KeyRepeat
+   - System Enviroments - キーボード - KeyRepeat to fastest
+ 1. (SystemSettings) Change `caps lock` to `control`
+   - System Enviroments - キーボード - キーボードショートカット - modification key - Change Caps Lock to Control(キーボード毎に設定)
+ 1. (SystemSettings) Change KeyMap for change window of same App
+   - System Enviroments - キーボード - キーボードショートカット - キーボード - 次のウィンドウを操作対処にする
+ 1. (SystemSettings) F1,F2などのキーを標準のファンクションキーとして使用する
+   - System Enviroments - キーボード - キーボードショートカット - ファンクションキー - F1,F2などのキーを標準のファンクションキーとして使用する
+ 1. (SystemSettings) 入力ソースの切り替えショートカット
+   - System Enviroments - キーボード - キーボードショートカット - 入力ソース - 前の入力ソースを選択、入力メニューの次のソースを選択
+ 1. (SystemSettings) 起動時の音を消す
+   - System Enviroments - サウンド - 起動時にサウンドを再生
+ 1. (SystemSettings) 画面解像度
+   - System Enviroments - Display - スペースを拡大
+ 1. (SystemSettings) コントロールセンター
+   - System Enviroments - コントロールセンター 以下を常に表示
+     - Wifi,Bluetooth,AirDrop,サウンド
+ 1. (SystemSettings) Disable Mission Control
+   - System Enviroments - キーボード - キーボードショートカット - Mission Control
+ 1. Install from App Store
+   - BetterSnapTool
+   - XCode
+ 1. Install from Web
+   - Google Chrome
+   - Google Japanese IME
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
EOF
}
