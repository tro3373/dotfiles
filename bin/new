#!/bin/bash

current_dir=$(pwd)
dotbin=${DOTPATH:-~/.dot}/bin

usage() {
    local command_name=$(basename $0)
    echo "Create new executable shell file."
    echo
    echo "Usage:"
    echo "    $command_name [option] <create_file_name>"
    echo "  Options"
    echo "    -b|--bin : Create new command file in $dotbin"
    echo "    -s|--simple : Use simple template"
}

main(){
    if [[ $# -eq 0 || $# -gt 2 ]]; then
        usage
        exit 1
    fi
    local args=$*
    local tobin=0
    local simple=0
    local reg_b='^-b$|^--bin$'
    local reg_s='^-s$|^--simple$'
    local f=
    for arg in $args; do
        if [[ $arg =~ $reg_b ]]; then
            tobin=1
            continue
        fi
        if [[ $arg =~ $reg_s ]]; then
            simple=1
            continue
        fi
        f=$arg
    done
    local out=$current_dir
    if [[ $tobin -eq 1 ]]; then
        out=$dotbin
    fi
    local target=$out/$f
    if [[ -e $target ]]; then
        echo "Target $target is exist."
        exit 1
    fi
    template=$dotbin/lib/template.sh
    if [[ $simple -eq 1 ]]; then
        template=$dotbin/lib/template_s.sh
    fi
    cp $template $target
    vim $target
}
main $*

