#!/usr/bin/env bash

current_dir=$(pwd)
script_dir=$(cd $(dirname $0); pwd)
command_name=$(basename $0)

dotbin=${DOTPATH:-~/.dot}/bin
target=
usage() {
    cat <<EOF
Create new executable shell file.
  Usage:
      $command_name [option] <create_file_name>
    Options
      -h|--help : Show this usage
      -b|--bin : Create new command file in $dotbin
      -s|--simple : Use simple template
EOF
}

has() {
    which ${1} >/dev/null 2>&1
    return $?
}

set_args() {
    for arg in "$@"; do
        case "$arg" in
            -h|--help)
                usage
                exit 0
                ;;
            -b|--bin)
                # file=${arg#*=}
                tobin=1
                ;;
            -s|--simple)
                simple=1
                ;;
            *)
                target="$arg"
                ;;
        esac
    done
}

check() {
    if [[ -z $target ]]; then
        echo "Specify target command name." 1>&2
        usage
        exit 1
    fi
}

initialize() {
    set_args "$@"
    check
}

main(){
    initialize "$@"
    local out=$current_dir
    if [[ $tobin -eq 1 ]]; then
        out=$dotbin
    fi
    local target=$out/$target
    if [[ -e $target ]]; then
        echo "Target $target is exist." 1>&2
        exit 1
    fi
    template=$dotbin/lib/template
    if [[ $simple -eq 1 ]]; then
        template=$dotbin/lib/template_s
    fi
    cp $template $target
    vim $target
}
main "$@"

