#!/usr/bin/env sh

readonly debug=0
ini() {
  echo "(vpn_endpoint) ==> Initializing..."
  [[ -e /root/.ssh ]] && echo "/root/.ssh exists" && exit 1
  cp -rfp /root/ssh /root/.ssh && chown 0.0 -R /root/.ssh/
  source /root/.vpn
}

main() {
  ini
  echo "(vpn_endpoint) ==> Connecting to $vpn_srv..."
  # local devnull=
  # if [ $debug -ne 1 ]; then
  #   devnull="> /dev/null"
  # fi
  # pwd
  # ls -la /root/.ssh
  echo "$vpn_pwd" |
    /usr/local/sbin/openconnect \
      --passwd-on-stdin \
      --user $vpn_usr \
      -b $vpn_srv \
      --servercert sha1:$vpn_sh1 &&
    echo "(vpn_endpoint) ==> Open connected. Excuting $* .." &&
    sleep 1 &&
    eval "$@"
  echo "(vpn_endpoint) ==> Done"
}
main "$@"
