#!/usr/bin/env bash

readonly current_dir=$(pwd)
readonly script_dir=$(
  cd "$(dirname ${BASH_SOURCE:-$0})"
  pwd
)
readonly conf=$HOME/.vpn
has() { command -v ${1} >&/dev/null; }
main() {
  ! test -e $conf && echo "No conf exists. path=$conf" 1>&2 && exit 1
  ! has docker && echo "No docker exists." 1>&2 && exit 1
  test $# -eq 0 && echo "No execute command exists." 1>&2 && exit 1

  docker run -it --rm \
    -v $script_dir/vpn_endpoint:/usr/local/bin/vpn_endpoint \
    -v $HOME/.ssh:/root/ssh \
    -v $conf:/root/.vpn \
    -v $current_dir:$current_dir \
    -w $current_dir \
    --privileged \
    ornew/vsh-cisco \
    /usr/local/bin/vpn_endpoint "$@"
}
main "$@"
